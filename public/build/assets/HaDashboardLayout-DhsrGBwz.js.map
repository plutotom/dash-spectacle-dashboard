{"version":3,"file":"HaDashboardLayout-DhsrGBwz.js","sources":["../../../resources/js/Components/ImageBackgroundComponentGooglePhotos.tsx","../../../node_modules/.pnpm/react-error-boundary@6.0.0_react@18.3.1/node_modules/react-error-boundary/dist/react-error-boundary.js","../../../resources/js/Layouts/RemountingErrorBoundary.tsx","../../../resources/js/Layouts/HaDashboardLayout.tsx"],"sourcesContent":["import axios, { AxiosResponse } from 'axios';\nimport { PropsWithChildren, useEffect, useState } from 'react';\n\nconst isDevelopment = process.env.NODE_ENV === 'development';\n\ninterface RandomPhotoResponse extends AxiosResponse {\n    data: {\n        success: boolean;\n        url: string;\n        media_metadata_width: number;\n    };\n}\n\nconst DEFAULT_BACKGROUND_IMAGE = 'https://ucarecdn.com/05f649bf-b70b-4cf8-90f7-2588ce404a08/';\n\n/**\n * ImageBackgroundComponent is a React component that displays a random background image from a predefined list.\n * It changes the background image every 10 minutes.\n *\n * @param {PropsWithChildren} props - The component props.\n * @returns {JSX.Element} The component JSX.\n */\nexport default function ImageBackgroundComponentGooglePhotos({ children }: PropsWithChildren) {\n    const [currentBackground, setCurrentBackground] = useState<string | null>(null);\n    const [error, setError] = useState<boolean>(false);\n    const [errorMessage, setErrorMessage] = useState<string | null>(null);\n    const [isLoading, setIsLoading] = useState<boolean>(true);\n    const ignoreDevelopmentPhoto = false;\n\n    const fetchRandomPhoto = async () => {\n        try {\n            if (isDevelopment && ignoreDevelopmentPhoto) {\n                console.log('Using default image due to being in development mode');\n                setCurrentBackground(DEFAULT_BACKGROUND_IMAGE);\n                setError(false);\n                return;\n            }\n\n            setError(false);\n\n            // Try Google Photos first\n            try {\n                const response: RandomPhotoResponse = await axios.get('/api/random-photo-from-dashboard-album');\n                if (response.status === 200 && response.data.success) {\n                    setCurrentBackground(response.data.url);\n                    setError(false);\n                    setErrorMessage(null);\n                    return;\n                }\n            } catch (googleErr) {\n                console.log('Google Photos fetch failed, trying local photos...');\n            }\n\n            // If Google Photos fails, try local photos\n            try {\n                const localResponse: RandomPhotoResponse = await axios.get('/api/random-photo-local');\n                if (localResponse.status === 200 && localResponse.data.success) {\n                    console.log('Local photos fetch successful');\n                    console.log(localResponse.data);\n                    setCurrentBackground(localResponse.data.url);\n                    setError(false);\n                    setErrorMessage(null);\n                    return;\n                }\n            } catch (localErr) {\n                console.error('Local photos fetch failed:', localErr);\n            }\n\n            // If both fail, use default\n            setCurrentBackground(DEFAULT_BACKGROUND_IMAGE);\n            console.log('Failed to fetch photos from both Google Photos and local storage, using default background');\n            setError(true);\n            setErrorMessage('Failed to fetch photos from both Google Photos and local storage');\n        } catch (err) {\n            console.error('Failed to fetch photo:', err);\n            setError(true);\n            setErrorMessage(err instanceof Error ? err.message : 'Unknown error');\n            setCurrentBackground(DEFAULT_BACKGROUND_IMAGE);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    useEffect(() => {\n        fetchRandomPhoto();\n        const interval = setInterval(fetchRandomPhoto, 1000 * 60 * 10); // 10 minutes\n\n        return () => clearInterval(interval);\n    }, []);\n\n    if (isLoading) {\n        return <div>Loading...</div>;\n    }\n\n    return (\n        <div>\n            <div\n                id=\"background-image-container\"\n                className=\"min-h-screen bg-gray-900\"\n                style={{\n                    backgroundImage: `url(${new URL(currentBackground || DEFAULT_BACKGROUND_IMAGE).href})`,\n                    // backgroundImage: `url(${currentBackground})`,\n                    // backgroundImage: `url(${DEFAULT_BACKGROUND_IMAGE})`,\n                    backgroundSize: 'cover',\n                    backgroundPosition: 'center',\n                    backgroundRepeat: 'no-repeat',\n                    transition: 'background-image 1s ease-in-out',\n                }}\n            >\n                {/* {error && <div className=\"text-muted-foreground\">{errorMessage}</div>} */}\n                <BackgroundGradient>{children}</BackgroundGradient>\n            </div>\n        </div>\n    );\n}\n\nfunction BackgroundGradient({ children }: PropsWithChildren) {\n    return (\n        <div\n            className=\"\"\n            style={{\n                background: `\n        linear-gradient(to bottom,\n            rgba(0, 0, 0, 0.2) 50%,\n            rgba(0, 0, 0, 0) 20%,\n            rgba(0, 0, 0, 0) 30%,\n            rgba(0, 0, 0, .2) 50%\n        )\n    `,\n            }}\n        >\n            {children}\n        </div>\n    );\n}\n","'use client';\nimport { createContext, Component, createElement, useContext, useState, useMemo, forwardRef } from 'react';\n\nconst ErrorBoundaryContext = createContext(null);\n\nconst initialState = {\n  didCatch: false,\n  error: null\n};\nclass ErrorBoundary extends Component {\n  constructor(props) {\n    super(props);\n    this.resetErrorBoundary = this.resetErrorBoundary.bind(this);\n    this.state = initialState;\n  }\n  static getDerivedStateFromError(error) {\n    return {\n      didCatch: true,\n      error\n    };\n  }\n  resetErrorBoundary() {\n    const {\n      error\n    } = this.state;\n    if (error !== null) {\n      var _this$props$onReset, _this$props;\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      (_this$props$onReset = (_this$props = this.props).onReset) === null || _this$props$onReset === void 0 ? void 0 : _this$props$onReset.call(_this$props, {\n        args,\n        reason: \"imperative-api\"\n      });\n      this.setState(initialState);\n    }\n  }\n  componentDidCatch(error, info) {\n    var _this$props$onError, _this$props2;\n    (_this$props$onError = (_this$props2 = this.props).onError) === null || _this$props$onError === void 0 ? void 0 : _this$props$onError.call(_this$props2, error, info);\n  }\n  componentDidUpdate(prevProps, prevState) {\n    const {\n      didCatch\n    } = this.state;\n    const {\n      resetKeys\n    } = this.props;\n\n    // There's an edge case where if the thing that triggered the error happens to *also* be in the resetKeys array,\n    // we'd end up resetting the error boundary immediately.\n    // This would likely trigger a second error to be thrown.\n    // So we make sure that we don't check the resetKeys on the first call of cDU after the error is set.\n\n    if (didCatch && prevState.error !== null && hasArrayChanged(prevProps.resetKeys, resetKeys)) {\n      var _this$props$onReset2, _this$props3;\n      (_this$props$onReset2 = (_this$props3 = this.props).onReset) === null || _this$props$onReset2 === void 0 ? void 0 : _this$props$onReset2.call(_this$props3, {\n        next: resetKeys,\n        prev: prevProps.resetKeys,\n        reason: \"keys\"\n      });\n      this.setState(initialState);\n    }\n  }\n  render() {\n    const {\n      children,\n      fallbackRender,\n      FallbackComponent,\n      fallback\n    } = this.props;\n    const {\n      didCatch,\n      error\n    } = this.state;\n    let childToRender = children;\n    if (didCatch) {\n      const props = {\n        error,\n        resetErrorBoundary: this.resetErrorBoundary\n      };\n      if (typeof fallbackRender === \"function\") {\n        childToRender = fallbackRender(props);\n      } else if (FallbackComponent) {\n        childToRender = createElement(FallbackComponent, props);\n      } else if (fallback !== undefined) {\n        childToRender = fallback;\n      } else {\n        throw error;\n      }\n    }\n    return createElement(ErrorBoundaryContext.Provider, {\n      value: {\n        didCatch,\n        error,\n        resetErrorBoundary: this.resetErrorBoundary\n      }\n    }, childToRender);\n  }\n}\nfunction hasArrayChanged() {\n  let a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  let b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  return a.length !== b.length || a.some((item, index) => !Object.is(item, b[index]));\n}\n\nfunction assertErrorBoundaryContext(value) {\n  if (value == null || typeof value.didCatch !== \"boolean\" || typeof value.resetErrorBoundary !== \"function\") {\n    throw new Error(\"ErrorBoundaryContext not found\");\n  }\n}\n\nfunction useErrorBoundary() {\n  const context = useContext(ErrorBoundaryContext);\n  assertErrorBoundaryContext(context);\n  const [state, setState] = useState({\n    error: null,\n    hasError: false\n  });\n  const memoized = useMemo(() => ({\n    resetBoundary: () => {\n      context.resetErrorBoundary();\n      setState({\n        error: null,\n        hasError: false\n      });\n    },\n    showBoundary: error => setState({\n      error,\n      hasError: true\n    })\n  }), [context.resetErrorBoundary]);\n  if (state.hasError) {\n    throw state.error;\n  }\n  return memoized;\n}\n\nfunction withErrorBoundary(component, errorBoundaryProps) {\n  const Wrapped = forwardRef((props, ref) => createElement(ErrorBoundary, errorBoundaryProps, createElement(component, {\n    ...props,\n    ref\n  })));\n\n  // Format for display in DevTools\n  const name = component.displayName || component.name || \"Unknown\";\n  Wrapped.displayName = \"withErrorBoundary(\".concat(name, \")\");\n  return Wrapped;\n}\n\nexport { ErrorBoundary, ErrorBoundaryContext, useErrorBoundary, withErrorBoundary };\n","import { ReactNode, useEffect, useState } from 'react';\nimport { ErrorBoundary } from 'react-error-boundary';\n\ntype RemountingErrorBoundaryProps = {\n    children: ReactNode;\n    intervalMs?: number;\n    fallback?: ReactNode;\n};\n\nexport default function RemountingErrorBoundary({ children, intervalMs = 60_000, fallback }: RemountingErrorBoundaryProps) {\n    const [resetKey, setResetKey] = useState(0);\n\n    useEffect(() => {\n        if (resetKey === 0) return;\n        const timer = setTimeout(() => setResetKey((k) => k + 1), intervalMs);\n        return () => clearTimeout(timer);\n    }, [resetKey, intervalMs]);\n\n    return (\n        <ErrorBoundary\n            fallbackRender={() => fallback ?? <div>Something went wrong. Retrying in {intervalMs / 60000} minutes...</div>}\n            onReset={() => setResetKey((k) => k + 1)}\n            resetKeys={[resetKey]}\n        >\n            {children}\n        </ErrorBoundary>\n    );\n}\n","import ImageBackgroundComponentGooglePhotos from '@/Components/ImageBackgroundComponentGooglePhotos';\nimport RemountingErrorBoundary from '@/Layouts/RemountingErrorBoundary';\nimport { PropsWithChildren, ReactNode } from 'react';\nfunction HaDashboardLayout({ children }: PropsWithChildren<{ header?: ReactNode }>) {\n    return (\n        <>\n            {/* <ImageBackgroundComponent> */}\n            <RemountingErrorBoundary\n                fallback={\n                    <div className=\"relative\">\n                        <main>{children}</main>\n                    </div>\n                }\n            >\n                <ImageBackgroundComponentGooglePhotos>\n                    <div className=\"relative\">\n                        <main>{children}</main>\n                    </div>\n                </ImageBackgroundComponentGooglePhotos>\n            </RemountingErrorBoundary>\n            {/* </ImageBackgroundComponent> */}\n        </>\n    );\n}\n\nexport default HaDashboardLayout;\n"],"names":["isDevelopment","DEFAULT_BACKGROUND_IMAGE","ImageBackgroundComponentGooglePhotos","children","currentBackground","setCurrentBackground","useState","error","setError","errorMessage","setErrorMessage","isLoading","setIsLoading","ignoreDevelopmentPhoto","fetchRandomPhoto","response","axios","localResponse","localErr","err","useEffect","interval","jsx","BackgroundGradient","ErrorBoundaryContext","createContext","initialState","ErrorBoundary","Component","props","_this$props$onReset","_this$props","_len","args","_key","info","_this$props$onError","_this$props2","prevProps","prevState","didCatch","resetKeys","hasArrayChanged","_this$props$onReset2","_this$props3","fallbackRender","FallbackComponent","fallback","childToRender","createElement","a","b","item","index","RemountingErrorBoundary","intervalMs","resetKey","setResetKey","timer","k","jsxs","HaDashboardLayout","Fragment"],"mappings":"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","x_google_ignoreList":[1]}